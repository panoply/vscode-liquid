{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Shopify Liquid (HTML)",
	"scopeName": "text.html.liquid",
	"fileTypes": [
		"liquid"
	],
	"patterns": [
		{
			"include": "#liquid_sections"
		},
		{
			"include": "#html_sections"
		},
		{
			"name": "comment.block.liquid",
			"begin": "{%-?\\s*comment\\s*-?%}",
			"end": "{%-?\\s*endcomment\\s*-?%}"
		},
		{
			"name": "punctuation.output.liquid",
			"begin": "{{-?",
			"end": "-?}}",
			"patterns": [
				{
					"include": "#liquid_syntaxes"
				}
			]
		},
		{
			"name": "punctuation.tag.liquid",
			"begin": "{%-?",
			"end": "-?%}",
			"patterns": [
				{
					"include": "#liquid_tags"
				},
				{
					"include": "#liquid_syntaxes"
				}
			]
		},
		{
			"include": "text.html.basic"
		}
	],
	"repository": {
		"entities": {
      "patterns": [
        {
          "captures": {
            "1": {
              "name": "punctuation.definition.entity.html"
            },
            "3": {
              "name": "punctuation.definition.entity.html"
            }
          },
          "match": "(&)([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+)(;)",
          "name": "constant.character.entity.html"
        },
        {
          "match": "&",
          "name": "invalid.illegal.bad-ampersand.html"
        }
      ]
    },
		"assign_op": {
			"patterns": [
				{
					"name": "keyword.operator.assignment.augmented.liquid",
					"match": "/="
				}
			]
		},
		"logic_expression": {
			"patterns": [
				{
					"match": "/=",
					"name": "keyword.operator.assignment.augmented.liquid"
				}
			]
		},
		"logic_op": {
			"patterns": [
				{
					"name": "keyword.operator.logical.liquid",
					"match": "\\s+(and|or|not|contains|(\\!\\=|\\=\\=|<\\=|>\\=|<|>)\\s+"
				}
			]
		},
		"liquid_tags": {
			"patterns": [
				{
					"name": "entity.name.tag.liquid",
					"match": "(?<={%)\\s*(\\w+)"
				},
				{
					"name": "entity.name.tag.liquid",
					"match": "(?<={%-)\\s*(\\w+)"
				}
			]
		},
		"liquid_syntaxes": {
			"patterns": [
				{
					"match": "(\\[)(\\|)(?=[^\\]]*)(?=\\])",
					"captures": {
						"2": {
							"name": "invalid.illegal.filter.liquid"
						},
						"3": {
							"name": "invalid.illegal.filter.liquid"
						}
					}
				},
				{
					"name": "invalid.illegal.filter.liquid",
					"match": "(?<=\\s)(\\+|\\-|\\/|\\*)(?=\\s)"
				},
				{
					"name": "constant.language.liquid",
					"match": "(false|true|nil)"
				},
				{
					"match": "(?=if|unless|elsif)\\s*[^%}]+\\s(in)\\s",
					"captures": {
						"3": {
							"name": "invalid.illegal.operator.liquid"
						}
					}
				},
				{
					"name": "keyword.operator.liquid",
					"match": "\\s+(and|or|not|contains|in|by|((\\!|\\=|\\<|\\>)\\=))\\s+"
				},
				{
					"match": "(?<=assign)([^\\=]+)(\\=\\=+)",
					"captures": {
						"2": {
							"name": "invalid.illegal.assignment.liquid"
						}
					}
				},
				{
					"name": "support.function.with-args.liquid",
					"match": "\\|\\s+(?![\\.0-9])[a-zA-Z0-9_-]+\\:\\s+"
				},
				{
					"name": "support.function.without-args.liquid",
					"match": "\\|\\s+(?![\\.0-9])[a-zA-Z0-9_-]+\\s+"
				},
				{
					"name": "keyword.control.liquid",
					"match": "(?<=\\s)(with|offset\\:|limit\\:)(?=\\s)"
				},
				{
					"match": "(?<=include)(.*)(with\\:|offset|limit)(?=\\s)",
					"captures": {
						"2": {
							"name": "invalid.illegal.argument.liquid"
						}
					}
				},
				{
					"name": "invalid.illegal.liquid",
					"match": "(?<=\\s)(\\w+\\:)(?=\\:\\s)"
				},
				{
					"name": "string.quoted.double.liquid",
					"begin": "\"",
					"end": "\""
				},
				{
					"name": "string.quoted.single.liquid",
					"begin": "'",
					"end": "'"
				},
				{
					"name": "constant.numeric.liquid",
					"match": "(-|\\+)?\\s*[0-9]+(\\.[0-9]+)?"
				},
				{
					"name": "support.class.liquid",
					"match": "\\b(collection|product|linklist|linklists|order|link|customer|customer_address|line_item|shop|collections|page_title|template|image|blog|blogs|cart|pages|theme|themes|variant|items|comment|forloop|settings|checkout|shipping_method|transaction|tax_line|form|order|discount|fulfillment|paginate|search|tablerow|schema|javascript|stylesheet|scripts|request)\\b"
				},
				{
					"name": "support.class.liquid",
					"match": "\\b(assets|body_raw|current|results|date|excerpt_raw|meta|next|pages|products|parent|posts|previous|site|tags|taxonomy|url|all_products|country_option_tags)\\b"
				},
				{
					"name": "variable.parameter.liquid",
					"match": "((?<=\\w\\:\\s)\\w+)"
				},
				{
					"name": "support.variable.liquid",
					"match": "(?<=\\.)\\w+\\b"
				},
				{
					"name": "variable.other.liquid",
					"match": "\\w+"
				}
			]
		},
		"liquid_sections": {
			"patterns": [
				{
					"name": "meta.attribute.style.html.liquid",
					"begin": "{%\\s*(stylesheet|\\s*((?:'|\")(scss)(.*)(?:'|\")))()\\s*%}",
					"beginCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						},
						"2": {
							"patterns": [
								{
									"include": "source.css.scss"
								},
								{
									"name": "entity.name.tag.liquid"
								}
							]
						}
					},
					"end": "{%\\s*(endstylesheet)\\s*%}",
					"endCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						}
					},
					"patterns": [
						{
							"include": "source.css"
						}
					]
				},
				{
					"name": "meta.attribute.style.html.liquid",
					"begin": "{%\\s*(stylesheet\\s*('scss'|\"scss\"))\\s*%}",
					"beginCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						},
						"2": {
							"name": "string.quoted.liquid"
						}
					},
					"end": "{%\\s*(endstylesheet)\\s*%}",
					"endCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						}
					},
					"patterns": [
						{
							"include": "source.css.scss"
						}
					]
				},
				{
					"name": "meta.embedded.js.liquid",
					"begin": "{%\\s*(javascript)\\s*%}",
					"beginCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						}
					},
					"end": "{%\\s*(endjavascript)\\s*%}",
					"endCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						}
					},
					"patterns": [
						{
							"include": "#liquid_tags"
						},
						{
							"include": "source.js"
						}
					]
				},
				{
					"name": "meta.embedded.json.liquid",
					"begin": "{%\\s*(schema)\\s*%}",
					"beginCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						}
					},
					"end": "{%\\s*(endschema)\\s*%}",
					"endCaptures": {
						"1": {
							"name": "entity.name.tag.liquid"
						}
					},
					"patterns": [
						{
							"include": "source.json"
						}
					]
				}
			]
		},
		"html_sections": {
			"patterns": [
				{
					"begin": "(<)(stream)(?![^/>]*/>\\s*$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.html"
						}
					},
					"end": "(</)(stream)(>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</stream>)",
							"patterns": [
								{
									"name": "string.html",
									"match": "(\\w+)(?=\\s*:\\s*)"
								},
								{
									"name": "invalid.illegal",
									"match": "(\\w+-\\w+|-\\w+|\\w+-)(?=\\s*:\\s*)"
								},
								{
									"name": "string.quoted.double.html",
									"match": "\"[a-zA-Z0-9:_.-]+\"(?=:)"
								},
								{
									"name": "string.quoted.single.html",
									"match": "'[a-zA-Z0-9:_.-]+'(?=:)"
								},
								{
									"name": "constant.numeric.html",
									"match": "[0-9]"
								},
								{
									"name": "string.quoted.double.html",
									"match": "(?<=:)\\s*\"(.*?)\\s*\""
								},
								{
									"name": "string.quoted.single.html",
									"match": "(?<=:)\\s*'(.*?)'"
								},
								{
									"name": "constant.language.html",
									"match": "(?<=:\\s)(false|true|nil)"
								},
								{
									"match": "(@(stream)[(])(['\"a-zA-Z_/.:0-9-]+)([)])",
									"captures": {
										"1": {
											"name": "support.function.without-args.html"
										},
										"3": {
											"name": "string.html"
										},
										"4": {
											"name": "support.function.without-args.html"
										}
									}
								},
								{
									"include": "text.html.liquid"
								}
							]
						}
					]
				},
				{
					"begin": "(<)(partial)(?![^/>]*/>\\s*$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.html"
						}
					},
					"end": "(</)(partial)(>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.template.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</partial>)",
							"patterns": [
								{
									"include": "text.html.liquid"
								}
							]
						}
					]
				},
				{
					"begin": "(<)(snippet)(?![^/>]*/>\\s*$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.html"
						}
					},
					"end": "(</)(snippet)(>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.template.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</snippet>)",
							"patterns": [
								{
									"match": "(@(partial)[(])(['\"a-zA-Z_/.:0-9-]+)([)])",
									"captures": {
										"1": {
											"name": "support.function.without-args.html"
										},
										"3": {
											"name": "string.html"
										},
										"4": {
											"name": "support.function.without-args.html"
										}
									}
								},
								{
									"include": "text.html.liquid"
								}
							]
						}
					]
				},
				{
					"begin": "(<)(template)(?![^/>]*/>\\s*$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.html"
						}
					},
					"end": "(</)(template)(>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.template.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</template>)",
							"patterns": [
								{
									"match": "(@(partial|snippet)[(])(['\"a-zA-Z-_/.:0-9-]+)([)])",
									"captures": {
										"1": {
											"name": "support.function.without-args.html"
										},
										"3": {
											"name": "string.html"
										},
										"4": {
											"name": "support.function.without-args.html"
										}
									}
								},
								{
									"include": "text.html.liquid"
								}
							]
						}
					]
				},
				{
					"begin": "(<)(schema)(?![^/>]*/>\\s*$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.html"
						}
					},
					"end": "(</)(schema)(>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.template.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</schema>)",
							"patterns": [
								{
									"match": "(@(schema)[(])(['\"a-zA-Z_/.:0-9-]+)([)])",
									"captures": {
										"1": {
											"name": "support.function.without-args.html"
										},
										"3": {
											"name": "string.html"
										},
										"4": {
											"name": "support.function.without-args.html"
										}
									}
								},
								{
									"include": "source.json"
								}
							]
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						}
					},
					"begin": "(<)(style)\\b(?=[^/>]*/>\\s*$)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(/>)",
					"patterns": [
						{
							"include": "#tag-extends"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						}
					},
					"begin": "(<)(style)(?=[^>]*>[^/>]*</style>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(</)(style)(>)",
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</style>)"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						}
					},
					"begin": "(<)(style)\\b(?=[^>]*lang=('sass'|\"sass\"))(?![^/>]*/>\\s*$)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(</)(style)(>)",
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</style>)",
							"patterns": [
								{
									"include": "source.sass"
								}
							],
							"contentName": "source.sass"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						}
					},
					"begin": "(<)(style)\\b(?=[^>]*lang=('scss'|\"scss\"))(?![^/>]*/>\\s*$)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.style.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(</)(style)(>)",
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</style>)",
							"patterns": [
								{
									"include": "source.css.scss"
								}
							],
							"contentName": "source.css.scss"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						}
					},
					"begin": "(<)(script)\\b(?=[^>]*/>$)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(/>)",
					"patterns": [
						{
							"include": "#tag-extends"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						}
					},
					"begin": "(<)(script)(?=[^>]*>[^/>]*</script>)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(</)(script)(>)",
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</script>)"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						}
					},
					"begin": "(<)(script)\\b(?=[^>]*lang=('ts'|\"ts\"))(?![^/>]*/>\\s*$)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(</)(script)(>)",
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</script>)",
							"patterns": [
								{
									"include": "source.ts"
								}
							],
							"contentName": "source.ts"
						}
					]
				},
				{
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						}
					},
					"begin": "(<)(script)(?![^/>]*/>\\s*$)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.html"
						},
						"2": {
							"name": "entity.name.tag.script.html"
						},
						"3": {
							"name": "punctuation.definition.tag.end.html"
						}
					},
					"end": "(</)(script)(>)",
					"patterns": [
						{
							"include": "#tag-extends"
						},
						{
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.tag.end.html"
								}
							},
							"begin": "(>)",
							"end": "(?=</script>)",
							"patterns": [
								{
									"include": "source.js"
								}
							],
							"contentName": "source.js"
						}
					]
				}
			]
		},
    "string-single-quoted": {
      "beginCaptures": {
        "0": {
          "name": "punctuation.definition.string.begin.html"
        }
      },
      "patterns": [
        {
          "include": "#entities"
        }
      ],
      "begin": "'",
      "endCaptures": {
        "0": {
          "name": "punctuation.definition.string.end.html"
        }
      },
      "end": "'",
      "name": "string.quoted.single.html"
    },
    "string-double-quoted": {
      "beginCaptures": {
        "0": {
          "name": "punctuation.definition.string.begin.html"
        }
      },
      "patterns": [
        {
          "include": "#entities"
        }
      ],
      "begin": "\"",
      "endCaptures": {
        "0": {
          "name": "punctuation.definition.string.end.html"
        }
      },
      "end": "\"",
      "name": "string.quoted.double.html"
    },
		"tag-generic-attribute": {
      "match": "\\b([a-zA-Z\\-:_]+)",
      "name": "entity.other.attribute-name.html"
    },
		"tag-extends": {
      "patterns": [
        {
          "include": "#tag-generic-attribute"
				},
				{
          "include": "#string-double-quoted"
        },
        {
          "include": "#string-single-quoted"
        }
      ]
    }
	},
	"foldingStartMarker": "(?x){%\\s*(if|unless|for|paginate|capture|form|case|tablerow|raw|comment)[^(%})]+%}",
	"foldingStopMarker": "(?x){%\\s*(endif|endunless|endfor|endpaginate|endcapture|endform|endcase|endtablerow|endraw|endcomment)[^(%})]+%}"
}
